<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>current</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="current_files/libs/clipboard/clipboard.min.js"></script>
<script src="current_files/libs/quarto-html/quarto.js"></script>
<script src="current_files/libs/quarto-html/popper.min.js"></script>
<script src="current_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="current_files/libs/quarto-html/anchor.min.js"></script>
<link href="current_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="current_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="current_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="current_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="current_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="finometer-to-python-example-project." class="level1">
<h1>Finometer to python example project.</h1>
<p>This document is a working example of how I’ve written and apllied this code to you Project. I will have sent on the two data files in</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pathlib <span class="im">as</span> pl</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Union, Optional, Tuple, List</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span> <span class="co">#needed to allow merging of multiple datasets      </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># saving the name of the data directory</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>data_folder <span class="op">=</span> pl.Path(<span class="vs">r'..\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23'</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># saving the path to the timestamps file</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>time_stamps <span class="op">=</span> <span class="vs">r'..\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Timesheets (1).csv'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># times columns</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>time_columns <span class="op">=</span> [<span class="st">'Participant ID'</span>, <span class="st">'Start of Baseline'</span>, <span class="st">'End of Baseline'</span>, <span class="st">'Start of Task 1'</span>, <span class="st">'End of Task 1'</span>, <span class="st">'Start of Recovery Period'</span>, <span class="st">'End of Recovery Period'</span>]</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#saving path to output directory</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>output <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\output'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I have converted this to markdown so that it can’t be re rerun. But the point of this cell is to clean up the case convention (upper and lowercase) used in the naming here.</p>
<pre><code>

# Loop through all files and folders in the tree containing the word 'participant'
for entry in data_folder.glob('**/*participant*'):
    # Check if the entry is a file or folder
    if entry.is_file() or entry.is_dir():
        # Get the current name of the file or folder
        current_name = entry.name
        # Convert the name to sentence case using the title() method
        new_name = current_name.replace('participant', 'Participant').title()
        # Rename the file or folder with the new name
        entry.rename(entry.with_name(new_name))


# Loop through all files in the tree containing the word 'participant'
for entry in data_folder.glob('**/*participant*'):
    # Check if the entry is a file
    if entry.is_file():
        # Get the current suffix (file extension) of the file
        current_suffix = entry.suffix
        # Convert the suffix to lowercase using the lower() method
        new_suffix = current_suffix.lower()
        # Rename the file with the new suffix
        new_entry = entry.with_suffix(new_suffix)
        entry.rename(new_entry)

#Cleaining up from previous tests
for i in data_folder.glob('**/*.csv'):
    i.unlink()
</code></pre>
<p>After this I need to work on finding the participants with two parts, then merging parts one and two together into a single file.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>multipart <span class="op">=</span> []</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> data_folder.iterdir():</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i.is_dir():</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">#check if ' Part 2' is in the stem of the folder</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'Part '</span> <span class="kw">in</span> i.stem:</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>            <span class="co"># save the folder name to a list</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            folder_name <span class="op">=</span> i.name</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>            multipart.append(folder_name)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>[<span class="bu">print</span>(i) <span class="cf">for</span> i <span class="kw">in</span> multipart]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Participant 23 Part 2_2022-11-04_17.00.16
Participant 30 Part 2_2022-11-08_11.24.07
Participant 65 Part 2_2022-11-22_11.18.00</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[None, None, None]</code></pre>
</div>
</div>
<p>Ok so we’ve found 3 participants with multipart studies.</p>
<p>Participant 23 Participant 30 Participant 65</p>
<p>I need to clean up the nameing of the first part of Participant 23, and then I need to work on combining parts 1 and 2 into one <code>.txt</code> file for all of them. I’m documenting this here so that it’s accounted for. I’m going to do it in a code cell and then conver the cell to markdown to be safe.</p>
<pre><code># removeing the words ' Part 1' from the folder and file stems
for i in data_folder.glob('**/*'):
    if ' Part 1' in i.stem:
        new_stem = i.stem.replace(' Part 1', '')
        new_name = i.parent.joinpath(new_stem + i.suffix)
        i.rename(new_name)
        print(new_name)</code></pre>
<p>Now to do some text editing and resaving.</p>
<p>So what I need to do is 1. find the part 1 <code>.txt</code> file and the part 2 <code>.txt</code> file 2. read them both into memory 3. extract the data (which begins on line 9 of the <code>.txt</code> files) from the part 2 file 4. write those lines onto the the end of the data in the part 1 folder <strong>without editing any of the earlier parts of the part 1 file</strong> 5. save this new version of the part 1 <code>.txt</code> - maybe save a note on one of the blank lines that this is a new file, but this can’t change the header structure (add new lines before line 9)</p>
<p>Also, for the mean time I should save these new <code>.txt</code> files in an output folder…</p>
<p>Let’s see what I can do.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saving the path to both part 1 and part 2 of participant 23</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>part1_23 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 23_2022-11-04_16.31.31\Participant 23_2022-11-04_16.31.31.txt'</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>part2_23 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 23 Part 2_2022-11-04_17.00.16\Participant 23 Part 2_2022-11-04_17.00.16.txt'</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>combined_23 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\output\Participant 23_2022-11-04_16.31.31.txt'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> append_cardio_data(</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    part1_file: Union[<span class="bu">str</span>, pl.Path],</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    part2_file: Union[<span class="bu">str</span>, pl.Path],</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    output_file: Optional[Union[<span class="bu">str</span>, pl.Path]] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> List[<span class="bu">str</span>]:</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Appends cardiovascular data from part 2 file to part 1 file and optionally writes the combined data to an output file.</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">    part1_file : Union[str, Path]</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">        File path of the part 1 file.</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">    part2_file : Union[str, Path]</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">        File path of the part 2 file.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">    output_file : Union[str, Path], optional</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">        File path of the output file to write the combined data (default is None).</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">    List[str]</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">        List of combined cardiovascular data.</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Read in the part 1 file</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(part1_file, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        lines_part1 <span class="op">=</span> f.readlines()</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Save the header above line 9 in file 1</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    header_part1 <span class="op">=</span> lines_part1[:<span class="dv">8</span>]</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Save the data from line 9 down from file 1</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    data_part1 <span class="op">=</span> lines_part1[<span class="dv">8</span>:]</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 4: Save the data from line 9 down in file 2</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(part2_file, <span class="st">'r'</span>) <span class="im">as</span> f:</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        lines_part2 <span class="op">=</span> f.readlines()[<span class="dv">9</span>:]</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 5: Append the data from file 2 to the bottom of the data from file 1</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    combined_data <span class="op">=</span> data_part1 <span class="op">+</span> lines_part2</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> output_file <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Step 6: Write all three things to a .txt file</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(output_file, <span class="st">'w'</span>) <span class="im">as</span> f:</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>            f.writelines(header_part1)</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>            f.writelines(combined_data)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined_data</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co"># # Example usage</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co"># append_cardio_data(part1_23, part2_23, combined_23)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So now when I run this I have a single file that combines both of the files for the participant (in this case Participant 23) into 1 <code>.txt</code> file, when you inspect the file you can see the time jump, partly because there’s a skip in the <code>'Time (s)'</code> column, but also you can see the recalibration period as shown below</p>
<pre><code>Time (s);Systolic Pressure (mmHg);Diastolic Pressure (mmHg);Mean Pressure (mmHg);Heart rate (bpm);Stroke Volume (ml);Left Ventricular Ejection Time (ms);Pulse Interval (ms);...
16:57:17.135;201;168;186;117;15.8;300;515;742;1.8;6.090;8120;;
17:00:19.705;0;0;0;103;0.0;0;585;0;0.0;0.000;0;;
17:00:20.290;0;0;0;103;0.0;0;580;0;0.0;0.000;0;;
17:00:20.870;0;0;0;76;0.0;0;785;0;0.0;0.000;0;;
17:00:21.655;0;0;0;31;0.0;0;1910;0;0.0;0.000;0;;
17:00:23.565;0;0;0;53;0.0;0;1130;0;0.0;0.000;0;;
17:00:24.695;0;0;0;100;0.0;0;600;0;0.0;0.000;0;; 
17:00:25.295;0;0;0;98;0.0;0;615;0;0.0;0.000;0;;
17:00:25.910;0;0;0;99;0.0;0;605;0;0.0;0.000;0;;
17:00:26.515;0;0;0;101;0.0;0;595;0;0.0;0.000;0;;
17:00:27.110;0;0;0;102;0.0;0;590;0;0.0;0.000;0;;
17:00:27.700;0;0;0;98;0.0;0;615;0;0.0;0.000;0;;
17:00:28.315;0;0;0;93;0.0;0;645;0;0.0;0.000;0;;
17:00:28.960;0;0;0;90;0.0;0;670;0;0.0;0.000;0;;
17:00:29.630;0;0;0;97;0.0;0;620;0;0.0;0.000;0;;
17:00:30.250;0;0;0;91;0.0;0;660;0;0.0;0.000;0;;
17:00:30.910;0;0;0;94;0.0;0;640;0;0.0;0.000;0;;
17:00:31.550;0;0;0;92;0.0;0;650;0;0.0;0.000;0;;
17:00:32.200;0;0;0;90;0.0;0;670;0;0.0;0.000;0;;
17:00:32.870;0;0;0;86;0.0;0;700;0;0.0;0.000;0;;
17:00:33.570;0;0;0;88;0.0;0;685;0;0.0;0.000;0;;
17:00:34.255;0;0;0;86;0.0;0;695;0;0.0;0.000;0;;
17:00:34.950;0;0;0;83;0.0;0;720;0;0.0;0.000;0;;
17:00:35.670;0;0;0;80;0.0;0;750;0;0.0;0.000;0;;
17:00:36.420;0;0;0;77;0.0;0;775;0;0.0;0.000;0;;
17:00:37.194;176;112;136;90;46.0;295;670;1675;4.1;1.977;2636;;
</code></pre>
<p>Now that we know we have a function that will work we can run it on the 3 problem participants and overwrite the part 1 <code>.txt</code> file with full data. This is a big part of why I wanted to document this process in a notebook so everyone can see exactly what’s been done. I can very easily call it on the participant 23 files because of the work up above</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># commented out to avoid overwriting the file</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># append_cardio_data(part1_23, part2_23, part1_23)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So now, Participant 23 has 1 file, in the folder with the correct name.</p>
<p>Lets do the same for Participants 30 and 65</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saving the path to both part 1 and part 2 of participant 30</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>p30_01 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 30_2022-11-08_10.40.42\Participant 30_2022-11-08_10.40.42.txt'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>p30_02 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 30 Part 2_2022-11-08_11.24.07\Participant 30 Part 2_2022-11-08_11.24.07.txt'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># saving the path to both part 1 and part 2 of participant 65</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>p65_01 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 65_2022-11-22_10.40.43\Participant 65_2022-11-22_10.40.43.txt'</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>p65_02 <span class="op">=</span> pl.Path(<span class="vs">r'C:\Users\kevin.omalley\OneDrive - University of Limerick\Documents\GitHub\fino2py\all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 65 Part 2_2022-11-22_11.18.00\Participant 65 Part 2_2022-11-22_11.18.00.txt'</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># creating the combined file for participant 30</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># append_cardio_data(p30_01, p30_02, p30_01)</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># commented to avoid repeating it now that the original part 1 file has been overwritten</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating the combined file for participant 65</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># append_cardio_data(p65_01, p65_02, p65_01) </span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># commented to avoid repeating it now that the original part 1 file  has been overwritten</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The 3 participants with multiple parts have been written together into a single <code>.txt</code> file (per participant), the original part 1 file has been overwritten to contain all the data and now I’m going to manually delete the part 2 folders for each person. This is why a ‘raw’ data corpus has been saved seperately as a zip archive so we can always go back and look at that data if needed.</p>
</section>
<section id="functions" class="level1">
<h1>Functions</h1>
<p>From here down are the function definitions. I’m not sure currently how to split this up currently as the functions don’t follow on in order, but I’ll see how that feels from now on.</p>
<section id="times" class="level2">
<h2 class="anchored" data-anchor-id="times">Times</h2>
<p>The functions immediately below relate handling the various time objects. There are two types of times 1. The <code>Time(s)</code> generated by the finometer as it captures data at each heart beat. - these are in the format ‘12:13:02.154’ (<code>'%H:%M:%S.%f'</code>). 2. The ‘timestamps’ generated by the research as the mark the start and end of each testing stage in their protocol. - these are either in the format ‘12:13:02’ (<code>'%H:%M:%S'</code> this is preferable), or ‘12:13’ (<code>'%H:%M'</code>, this would indicate a minor issue in timekeeping)</p>
<p>These require different functions and they need to be defined before the importing and reshaping takes place.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_fino_time(fino_time: <span class="bu">str</span>) <span class="op">-&gt;</span> dt.datetime.time:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Converts the string times produced by the Finometer to datime objects in the '%H:%M:%S.%f' format.</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">    fino_time : str</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The Finometer time in the format '%H:%M:%S.%f'</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co">    datetime.time</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The time as a `datetime.time` object.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>        time <span class="op">=</span> dt.datetime.strptime(fino_time, <span class="st">'%H:%M:%S.</span><span class="sc">%f</span><span class="st">'</span>).time()</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        time_str_no_ms <span class="op">=</span> time.strftime(<span class="st">'%H:%M:%S'</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>        time_obj_no_ms <span class="op">=</span> dt.datetime.strptime(time_str_no_ms, <span class="st">'%H:%M:%S'</span>).time()</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed to convert time </span><span class="sc">{</span>fino_time<span class="sc">}</span><span class="ss"> to datetime object. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> time_obj_no_ms</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_timestamp_time(timestamp_time: <span class="bu">str</span>) <span class="op">-&gt;</span> dt.datetime.time:</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert the timestamp time in the format '09:02:12' to datetime.time object without microseconds.</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">    timestamp_time : str</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The timestamp time in the format '09:02:12'</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">    datetime.time</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The time as a `datetime.time` object.</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        time <span class="op">=</span> dt.datetime.strptime(timestamp_time, <span class="st">'%H:%M:%S'</span>).time()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed to convert time </span><span class="sc">{</span>timestamp_time<span class="sc">}</span><span class="ss"> to datetime object. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> time</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_partial_time(partial_time: <span class="bu">str</span>) <span class="op">-&gt;</span> dt.datetime.time:</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Convert the partial time in the format '09:02' to a datetime.time object with 0 seconds.</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">    partial_time : str</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The partial time in the format '09:02'</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">    datetime.time</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The time as a `datetime.time` object with 0 seconds.</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>        time <span class="op">=</span> dt.datetime.strptime(partial_time, <span class="st">'%H:%M'</span>).time()</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>        time_str <span class="op">=</span> time.strftime(<span class="st">'%H:%M:%S'</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>        time_obj <span class="op">=</span> dt.datetime.strptime(time_str, <span class="st">'%H:%M:%S'</span>).time()</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed to convert time </span><span class="sc">{</span>partial_time<span class="sc">}</span><span class="ss"> to datetime object. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> time_obj</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(convert_partial_time(<span class="st">'09:02'</span>), <span class="bu">type</span>(convert_partial_time(<span class="st">'09:02'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>09:02:00 &lt;class 'datetime.time'&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(convert_timestamp_time(<span class="st">'09:02:12'</span>), <span class="bu">type</span>(convert_timestamp_time(<span class="st">'09:02:12'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>09:02:12 &lt;class 'datetime.time'&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(convert_fino_time(<span class="st">'09:02:12.142'</span>),<span class="bu">type</span>(convert_fino_time(<span class="st">'09:02:12.142'</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>09:02:12 &lt;class 'datetime.time'&gt;</code></pre>
</div>
</div>
<p>These functions appear to return the kind of object that we need to do the work, and the edit all the required times into the same <code>'%H:%M:%S'</code> format. So the next step is to define the functions that import the data from the finometer.</p>
</section>
<section id="importing" class="level2">
<h2 class="anchored" data-anchor-id="importing">importing</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> read_raw_finometer_data(folder_path: Union[<span class="bu">str</span>, pl.Path], interval: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>, save_csv: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> Tuple[pd.DataFrame, <span class="bu">str</span>]:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''This function imports the raw finometer data and then calculates the average of each measure over the selected time period</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">    The default time period is 1 minute, but this can be changed by setting the interval parameter to a different value. </span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">    This function may not be needed in many cases, but it is useful to have, and a good place to start.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co">    folder_path : pathlib.Path object or str </span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The path to the folder containing the .txt file</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="co">    interval : str, optional</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co">        If provided, the function will resample the data to the given interval and return the resampled data.</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co">    save_csv : bool, optional</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co">        If True, the function will save the imported data as a .csv file in the same folder as the .txt file.</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">        The default is False.</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="co">    TypeError:</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co">        If folder_path is not a pathlib.Path object or a string</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError:</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co">        If folder_path does not exist or is not a directory</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co">        If there is not exactly one .txt file in the folder</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a><span class="co">    pandas.DataFrame:</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="co">        Dataframe with the raw finometer data resampled to the given interval</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co">    ID : str</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="co">        The Participant ID of the participant whose data is being imported</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>        folder_path <span class="op">=</span> pl.Path(folder_path)</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">TypeError</span>:</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">'folder_path must be a pathlib.Path object or a string'</span>)</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> folder_path.exists():</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'folder_path does not exist'</span>)</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> folder_path.is_dir():</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>        files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> folder_path.glob(<span class="st">'*.txt'</span>)]</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(files) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f'Expected one .txt file, but found </span><span class="sc">{</span><span class="bu">len</span>(files)<span class="sc">}</span><span class="ss"> in the folder </span><span class="sc">{</span>folder_path<span class="sc">.</span>name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span> <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> folder_path.is_file():</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span> <span class="op">=</span> folder_path</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    ID <span class="op">=</span> <span class="bu">file</span>.stem.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span>,</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>        sep<span class="op">=</span><span class="st">';'</span>,</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>        header<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>        skiprows<span class="op">=</span><span class="dv">8</span>,</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>        skipfooter<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>        engine<span class="op">=</span><span class="st">'python'</span>,</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df[[<span class="st">'Time (s)'</span>, <span class="st">'Systolic Pressure (mmHg)'</span>, <span class="st">'Diastolic Pressure (mmHg)'</span>,</span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Mean Pressure (mmHg)'</span>, <span class="st">'Heart rate (bpm)'</span>, <span class="st">'Stroke Volume (ml)'</span>,</span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Left Ventricular Ejection Time (ms)'</span>, <span class="st">'Pulse Interval (ms)'</span>,</span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Maximum Slope (mmHg/s)'</span>, <span class="st">'Cardiac Output (l/min)'</span>,</span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Total Peripheral Resistance Medical Unit (mmHg.min/l)'</span>,</span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>       <span class="st">'Total Peripheral Resistance CGS (dyn.s/cm5)'</span>, <span class="st">'Markers'</span>]]</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>    df.index <span class="op">=</span> pd.to_datetime(df[<span class="st">'Time (s)'</span>], <span class="bu">format</span><span class="op">=</span><span class="st">'%H:%M:%S.</span><span class="sc">%f</span><span class="st">'</span>).dt.floor(<span class="st">'ms'</span>)</span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.drop(<span class="st">'Time (s)'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> interval: <span class="co"># if the user specifies an interval, resample the data to that interval</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.resample(<span class="ss">f'</span><span class="sc">{</span>interval<span class="sc">}</span><span class="ss">'</span>).mean()</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>        df.index <span class="op">=</span> df.index.strftime(<span class="st">'%H:%M:%S.</span><span class="sc">%f</span><span class="st">'</span>).<span class="bu">str</span>[:<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>        df.index <span class="op">=</span> df.index.strftime(<span class="st">'%H:%M:%S.</span><span class="sc">%f</span><span class="st">'</span>).<span class="bu">str</span>[:<span class="op">-</span><span class="dv">3</span>]</span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a>    csv_path <span class="op">=</span> folder_path <span class="op">/</span> <span class="bu">file</span>.with_stem(<span class="ss">f'imported data for </span><span class="sc">{</span>ID<span class="sc">}</span><span class="ss">'</span>).with_suffix(<span class="st">'.csv'</span>)</span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_csv:</span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>        df.to_csv(csv_path, index<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df, ID</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>a, a_id <span class="op">=</span> read_raw_finometer_data([i <span class="cf">for</span> i <span class="kw">in</span> data_folder.iterdir() <span class="cf">if</span> i.is_dir()][<span class="dv">0</span>], save_csv<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>a.columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>Index(['Systolic Pressure (mmHg)', 'Diastolic Pressure (mmHg)',
       'Mean Pressure (mmHg)', 'Heart rate (bpm)', 'Stroke Volume (ml)',
       'Left Ventricular Ejection Time (ms)', 'Pulse Interval (ms)',
       'Maximum Slope (mmHg/s)', 'Cardiac Output (l/min)',
       'Total Peripheral Resistance Medical Unit (mmHg.min/l)',
       'Total Peripheral Resistance CGS (dyn.s/cm5)', 'Markers'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_demographics(folder_path: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Reads in the demographics from the .txt file and returns a DataFrame row containing the data.</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co">    file_path (str): Path to the demographics file.</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">    demographics_df (pd.DataFrame): DataFrame containing the demographics data.</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        folder_path <span class="op">=</span> pl.Path(folder_path)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">TypeError</span>:</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">'folder_path must be a pathlib.Path object or a string'</span>)</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> folder_path.exists():</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'folder_path does not exist'</span>)</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> folder_path.is_dir():</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        files <span class="op">=</span> [<span class="bu">file</span> <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> folder_path.glob(<span class="st">'*.txt'</span>)]</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(files) <span class="op">!=</span> <span class="dv">1</span>:</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f'Expected one .txt file, but found </span><span class="sc">{</span><span class="bu">len</span>(files)<span class="sc">}</span><span class="ss"> in the folder'</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span> <span class="op">=</span> files[<span class="dv">0</span>]</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">elif</span> folder_path.is_file():</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span> <span class="op">=</span> folder_path</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    ID <span class="op">=</span> <span class="bu">file</span>.stem.split(<span class="st">'_'</span>)[<span class="dv">0</span>]</span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read in the demographics data from the file</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">file</span>,</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>        sep<span class="op">=</span><span class="st">';'</span>,</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>        header<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>        skiprows<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>        nrows<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        engine<span class="op">=</span><span class="st">'python'</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Select the relevant columns from the DataFrame</span></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    demographics_df <span class="op">=</span> df.loc[:, [<span class="st">'Identification'</span>, <span class="st">'Age (yrs)'</span>, <span class="st">'Height (cm)'</span>, <span class="st">'Weight (kg)'</span>, <span class="st">'Gender'</span>]]</span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename the columns</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>    demographics_df.columns <span class="op">=</span> [<span class="st">'Participant ID'</span>, <span class="st">'Age (years)'</span>, <span class="st">'Height (cm)'</span>, <span class="st">'Weight (kg)'</span>, <span class="st">'Gender'</span>]</span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> demographics_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_chunk(df, ID, tag, start, end):</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Create a chunk of data from a dataframe between specified start and end times and return a new dataframe</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">    containing the mean values for each column in the chunk.</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">    df : pandas DataFrame</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The dataframe containing the data to extract a chunk from.</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">    ID : str</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">        The participant ID to include in the output dataframe.</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="co">    tag : str</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co">        The tag to include in the column names of the output dataframe.</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co">    start : str or None</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="co">        The start time of the chunk in the format 'HH:MM:SS' or 'HH:MM:SS.mmm'. If None, the chunk starts at the </span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">        beginning of the dataframe.</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">    end : str or None</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">        The end time of the chunk in the format 'HH:MM:SS' or 'HH:MM:SS.mmm'. If None, the chunk ends at the </span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">        end of the dataframe.</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">    pandas DataFrame</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">        A new dataframe containing the mean values for each column in the specified chunk of the input dataframe.</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">        The output dataframe has a row for the specified participant ID and columns with names that include the</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">        specified tag.</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert the index to datetime (although this still feels like a kludge and I don't like it)</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    df.index <span class="op">=</span> pd.to_datetime(df.index, <span class="bu">format</span><span class="op">=</span><span class="st">'%H:%M:%S.</span><span class="sc">%f</span><span class="st">'</span>)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the chunk of data and compute the mean values for each column</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> start <span class="kw">and</span> end:</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> df.between_time(start_time<span class="op">=</span>start, end_time<span class="op">=</span>end).mean().to_frame().T</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> start:</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> df.between_time(start_time<span class="op">=</span>start).mean().to_frame().T</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> end:</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> df.between_time(end_time<span class="op">=</span>end).mean().to_frame().T</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>            chunk <span class="op">=</span> df.mean().to_frame().T</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"Failed to extract chunk between </span><span class="sc">{</span>start<span class="sc">}</span><span class="ss"> and </span><span class="sc">{</span>end<span class="sc">}</span><span class="ss">. Error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rename the columns with the specified tag and insert the participant ID as the first column</span></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    chunk.columns <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>tag<span class="sc">}</span><span class="ss"> </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> i <span class="kw">in</span> chunk.columns]</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    chunk.insert(<span class="dv">0</span>, <span class="st">'Participant ID'</span>, ID)</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> chunk</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_protocol_times(times_file_path: Union[pl.Path,<span class="bu">str</span>], cols_to_keep: <span class="bu">list</span>, save_csv: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This function imports the protocol times from a .csv file and returns a cleaned pandas dataframe with the protocol times for each participant.</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co">    times_file_path : pathlib.Path or str</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="co">        The path to the .csv file containing the protocol times.</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">    save_csv : bool, optional</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">        If True, the imported data will be saved as a .csv file in the same folder as the .csv file.</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">    TypeError:</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">        If times_file_path is not a pathlib.Path object.</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError:</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">        If times_file_path does not exist or is not a file.</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">        If times_file_path does not have a .csv extension.</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">    pandas.DataFrame</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co">        A cleaned pandas dataframe with the protocol times for each participant.</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">isinstance</span>(times_file_path, (<span class="bu">str</span>, pl.Path)), <span class="st">'file_path must be a pathlib.Path object or a string that can be converted to one.'</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(times_file_path, <span class="bu">str</span>):</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        times_file_path <span class="op">=</span> pl.Path(times_file_path)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> times_file_path.exists(), <span class="st">'file_path does not exist'</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> times_file_path.is_file(), <span class="st">'file_path is not a file'</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> times_file_path.suffix <span class="op">==</span> <span class="st">'.csv'</span>, <span class="st">'file_path is not a csv file, please save times file as a .csv file'</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> convert_time(time_str):</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">'''This function converts a time string to a datetime object if possible'''</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>            time_str <span class="op">=</span> time_str.strip(<span class="st">'"'</span>)</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(time_str) <span class="op">==</span> <span class="dv">5</span>:</span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> convert_partial_time(time_str)</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">len</span>(time_str) <span class="op">==</span> <span class="dv">8</span>:</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> convert_timestamp_time(time_str)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> np.nan</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> np.nan</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(times_file_path)</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    df.columns <span class="op">=</span> [col.strip() <span class="cf">for</span> col <span class="kw">in</span> df.columns]</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> cols_to_keep:</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df[cols_to_keep]</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns[<span class="dv">1</span>:]:</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col].<span class="bu">apply</span>(convert_time)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_csv: <span class="co">#if you want to save the csv file (which may be useful if you want to use the data in other ways)</span></span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>            df.to_csv(times_file_path.parent <span class="op">/</span> <span class="ss">f"cleaned times.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-59"><a href="#cb27-59" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"CSV saved for </span><span class="sc">{</span>times_file_path<span class="sc">.</span>stem<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-60"><a href="#cb27-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb27-61"><a href="#cb27-61" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Could not save csv file, error: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb27-62"><a href="#cb27-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-63"><a href="#cb27-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> import_protocol_times(</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    time_stamps, time_columns)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>y.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Participant ID</th>
      <th>Start of Baseline</th>
      <th>End of Baseline</th>
      <th>Start of Task 1</th>
      <th>End of Task 1</th>
      <th>Start of Recovery Period</th>
      <th>End of Recovery Period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Participant 1</td>
      <td>09:17:20</td>
      <td>09:27:20</td>
      <td>09:28:11</td>
      <td>09:35:10</td>
      <td>09:35:15</td>
      <td>09:43:15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Participant 2</td>
      <td>10:51:00</td>
      <td>11:05:05</td>
      <td>11:06:00</td>
      <td>11:11:10</td>
      <td>11:11:15</td>
      <td>11:19:20</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Participant 3</td>
      <td>12:20:36</td>
      <td>12:30:36</td>
      <td>12:34:22</td>
      <td>12:38:57</td>
      <td>12:38:59</td>
      <td>12:46:04</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Participant 4</td>
      <td>13:55:10</td>
      <td>14:05:10</td>
      <td>14:07:28</td>
      <td>14:11:59</td>
      <td>14:12:05</td>
      <td>14:20:05</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Participant 5</td>
      <td>15:13:00</td>
      <td>15:23:00</td>
      <td>15:25:00</td>
      <td>15:30:00</td>
      <td>15:30:00</td>
      <td>15:38:00</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>y[y.isna().<span class="bu">any</span>(axis<span class="op">=</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Participant ID</th>
      <th>Start of Baseline</th>
      <th>End of Baseline</th>
      <th>Start of Task 1</th>
      <th>End of Task 1</th>
      <th>Start of Recovery Period</th>
      <th>End of Recovery Period</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>53</th>
      <td>Participant 54</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>63</th>
      <td>Participant 64</td>
      <td>09:20:00</td>
      <td>09:30:00</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>124</th>
      <td>Participant 544</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>125</th>
      <td>Participant 545</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>126</th>
      <td>Participant 546</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># testing version of the function </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> import_protocol_averages(frame, <span class="bu">id</span>, times<span class="op">=</span><span class="va">None</span>, save_csv<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''A function that imports the averaged finometer files (which have already been processed from the raw data)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co">    to produce averages for each section of the experimental protocol.</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="co">    frame : pandas.DataFrame </span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The DataFrame containing the averaged finometer data</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co">    id : str</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="co">        The participant ID</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="co">    save_csv : bool, optional</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="co">        If True, the imported data will be saved as a .csv file in the same folder as the .csv file, </span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co">        this is not always needed and should be used sparingly</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="co">    times : dict, optional</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="co">        A dictionary of tuples of times, with the keys being the names of the time periods.</span></span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a><span class="co">    pandas.DataFrame</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="co">        A DataFrame with the mean values of the given columns during each time period of the study.</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Raises</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="co">    ------</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co">    TypeError</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co">        If frame is not a pandas.DataFrame object</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="co">        If id is not a string</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="co">    ValueError</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a><span class="co">        If times is not provided as a dictionary with at least one key-value pair</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a><span class="co">        If there are not enough times provided for a given time period</span></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a><span class="co">        If there are too many times provided for a given time period</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># check if frame is a pandas.DataFrame object</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(frame, pd.DataFrame):</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">'''</span></span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a><span class="st">        frame must be a pandas.DataFrame object, produced by the read_raw_finometer_data function, </span></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a><span class="st">        have you run the read_raw_finometer_data function on the data?'''</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(<span class="bu">id</span>, <span class="bu">str</span>):</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="st">'id must be a string'</span>)</span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> times:</span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"times must be a dictionary and at least one key-value pair must be provided."</span>)</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create an empty list of dataframes, each representing a chunk of the protocol</span></span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    chunks <span class="op">=</span> []</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> times.keys():</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(times[i]) <span class="op">&lt;</span> <span class="dv">2</span>:</span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"There are not enough times provided for the </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb30-53"><a href="#cb30-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(times[i]) <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb30-54"><a href="#cb30-54" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"There are too many times provided for the </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">."</span>)</span>
<span id="cb30-55"><a href="#cb30-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">len</span>(times[i]) <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb30-56"><a href="#cb30-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> times[i][<span class="dv">0</span>] <span class="op">&lt;</span> times[i][<span class="dv">1</span>]:</span>
<span id="cb30-57"><a href="#cb30-57" aria-hidden="true" tabindex="-1"></a>                chunks.append(create_chunk(frame, <span class="bu">id</span>, i, times[i][<span class="dv">0</span>], times[i][<span class="dv">1</span>]))</span>
<span id="cb30-58"><a href="#cb30-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-59"><a href="#cb30-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-60"><a href="#cb30-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" aria-hidden="true" tabindex="-1"></a>    data_merge <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> left, right: pd.merge(left, right, on<span class="op">=</span>[<span class="st">"Participant ID"</span>], how<span class="op">=</span><span class="st">"outer"</span>), chunks)</span>
<span id="cb30-62"><a href="#cb30-62" aria-hidden="true" tabindex="-1"></a>    data_merge.set_index(<span class="st">'Participant ID'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-63"><a href="#cb30-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-64"><a href="#cb30-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_csv:</span>
<span id="cb30-65"><a href="#cb30-65" aria-hidden="true" tabindex="-1"></a>        path <span class="op">=</span> pl.Path(save_csv)</span>
<span id="cb30-66"><a href="#cb30-66" aria-hidden="true" tabindex="-1"></a>        data_merge.to_csv( path <span class="op">/</span> <span class="ss">f"</span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss"> protocol_averages.csv"</span>)</span>
<span id="cb30-67"><a href="#cb30-67" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Saved </span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss"> protocol averages.csv to </span><span class="sc">{</span>path<span class="sc">.</span>stem<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb30-68"><a href="#cb30-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-69"><a href="#cb30-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data_merge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this cell runs the functions on all the different files and writes them to a single dataframe</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> y.iterrows():</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> row[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> {<span class="st">'baseline'</span> : [row[<span class="dv">1</span>][<span class="dv">1</span>], row[<span class="dv">1</span>][<span class="dv">2</span>]], <span class="st">'task'</span> : [row[<span class="dv">1</span>][<span class="dv">3</span>], row[<span class="dv">1</span>][<span class="dv">4</span>]], <span class="st">'recovery'</span> : [row[<span class="dv">1</span>][<span class="dv">5</span>], row[<span class="dv">1</span>][<span class="dv">6</span>]]}</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> data_folder.glob(<span class="st">'**'</span>):</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">id</span> <span class="op">==</span> folder.stem.split(<span class="st">'_'</span>)[<span class="dv">0</span>]:</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            df, df_id <span class="op">=</span> read_raw_finometer_data(folder)</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>                dfs.append(import_protocol_averages(df, df_id, times))</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Could not import protocol averages for </span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'default'</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>result_df <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then I save them to an excel file</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># result_df.to_excel(output/'Ailbhe data time one and two.xlsx')</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># and view the first 20 rows</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>result_df.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>baseline Systolic Pressure (mmHg)</th>
      <th>baseline Diastolic Pressure (mmHg)</th>
      <th>baseline Mean Pressure (mmHg)</th>
      <th>baseline Heart rate (bpm)</th>
      <th>baseline Stroke Volume (ml)</th>
      <th>baseline Left Ventricular Ejection Time (ms)</th>
      <th>baseline Pulse Interval (ms)</th>
      <th>baseline Maximum Slope (mmHg/s)</th>
      <th>baseline Cardiac Output (l/min)</th>
      <th>baseline Total Peripheral Resistance Medical Unit (mmHg.min/l)</th>
      <th>...</th>
      <th>recovery Mean Pressure (mmHg)</th>
      <th>recovery Heart rate (bpm)</th>
      <th>recovery Stroke Volume (ml)</th>
      <th>recovery Left Ventricular Ejection Time (ms)</th>
      <th>recovery Pulse Interval (ms)</th>
      <th>recovery Maximum Slope (mmHg/s)</th>
      <th>recovery Cardiac Output (l/min)</th>
      <th>recovery Total Peripheral Resistance Medical Unit (mmHg.min/l)</th>
      <th>recovery Total Peripheral Resistance CGS (dyn.s/cm5)</th>
      <th>recovery Markers</th>
    </tr>
    <tr>
      <th>Participant ID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Participant 1</th>
      <td>201.177229</td>
      <td>158.281418</td>
      <td>175.578947</td>
      <td>93.785177</td>
      <td>16.931901</td>
      <td>241.997852</td>
      <td>644.624060</td>
      <td>1120.077336</td>
      <td>1.583673</td>
      <td>6.766189</td>
      <td>...</td>
      <td>184.357039</td>
      <td>86.988389</td>
      <td>15.967634</td>
      <td>247.358491</td>
      <td>696.262700</td>
      <td>1243.576197</td>
      <td>1.388824</td>
      <td>8.275520</td>
      <td>11034.023222</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>174.749768</td>
      <td>119.989805</td>
      <td>142.184430</td>
      <td>78.142725</td>
      <td>28.795366</td>
      <td>219.295644</td>
      <td>778.234476</td>
      <td>1413.936979</td>
      <td>2.239296</td>
      <td>3.875071</td>
      <td>...</td>
      <td>146.425325</td>
      <td>76.980519</td>
      <td>29.906818</td>
      <td>288.733766</td>
      <td>787.873377</td>
      <td>1734.563312</td>
      <td>2.287013</td>
      <td>3.879511</td>
      <td>5172.691558</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Eve</th>
      <td>129.075871</td>
      <td>83.501244</td>
      <td>99.720149</td>
      <td>84.395522</td>
      <td>54.166667</td>
      <td>266.194030</td>
      <td>746.262438</td>
      <td>1421.238806</td>
      <td>4.529975</td>
      <td>1.500659</td>
      <td>...</td>
      <td>102.937500</td>
      <td>81.082721</td>
      <td>61.361949</td>
      <td>276.966912</td>
      <td>781.360294</td>
      <td>1611.580882</td>
      <td>4.899081</td>
      <td>1.974364</td>
      <td>2632.485294</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>138.128621</td>
      <td>92.714948</td>
      <td>109.310545</td>
      <td>86.833140</td>
      <td>40.428158</td>
      <td>267.937428</td>
      <td>695.185400</td>
      <td>1201.106605</td>
      <td>3.502549</td>
      <td>1.892425</td>
      <td>...</td>
      <td>119.121508</td>
      <td>90.459497</td>
      <td>35.469972</td>
      <td>264.385475</td>
      <td>670.181564</td>
      <td>1402.484637</td>
      <td>3.204050</td>
      <td>2.278200</td>
      <td>3037.578212</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>93.990654</td>
      <td>80.220561</td>
      <td>85.323364</td>
      <td>64.459813</td>
      <td>18.105794</td>
      <td>289.803738</td>
      <td>1026.046729</td>
      <td>239.471028</td>
      <td>1.179252</td>
      <td>6.109763</td>
      <td>...</td>
      <td>88.366730</td>
      <td>67.362949</td>
      <td>34.604537</td>
      <td>293.667297</td>
      <td>907.759924</td>
      <td>397.132325</td>
      <td>2.319660</td>
      <td>2.364981</td>
      <td>3153.315690</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 6</th>
      <td>106.450131</td>
      <td>79.707349</td>
      <td>85.530184</td>
      <td>73.707349</td>
      <td>31.032021</td>
      <td>294.967192</td>
      <td>819.061680</td>
      <td>623.863517</td>
      <td>2.281365</td>
      <td>2.324482</td>
      <td>...</td>
      <td>83.608014</td>
      <td>73.200348</td>
      <td>33.649826</td>
      <td>286.829268</td>
      <td>838.736934</td>
      <td>874.921603</td>
      <td>2.455749</td>
      <td>2.189387</td>
      <td>2919.163763</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>116.379518</td>
      <td>62.829819</td>
      <td>83.042922</td>
      <td>98.686747</td>
      <td>92.937801</td>
      <td>267.074548</td>
      <td>611.573795</td>
      <td>1552.516566</td>
      <td>9.143599</td>
      <td>0.554955</td>
      <td>...</td>
      <td>91.721193</td>
      <td>98.309671</td>
      <td>89.174794</td>
      <td>264.660494</td>
      <td>617.217078</td>
      <td>1940.726337</td>
      <td>8.755041</td>
      <td>0.652887</td>
      <td>870.530864</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 8 Correct</th>
      <td>201.799232</td>
      <td>144.032661</td>
      <td>161.606148</td>
      <td>109.024976</td>
      <td>55.949952</td>
      <td>285.806916</td>
      <td>570.100865</td>
      <td>1240.792507</td>
      <td>6.113641</td>
      <td>1.783168</td>
      <td>...</td>
      <td>170.406286</td>
      <td>102.499418</td>
      <td>47.423050</td>
      <td>278.981374</td>
      <td>607.409779</td>
      <td>1168.190920</td>
      <td>4.862049</td>
      <td>2.428739</td>
      <td>3238.316647</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>125.233402</td>
      <td>73.839212</td>
      <td>91.713693</td>
      <td>96.490664</td>
      <td>48.927282</td>
      <td>251.312241</td>
      <td>622.702282</td>
      <td>1395.449170</td>
      <td>4.715975</td>
      <td>1.170438</td>
      <td>...</td>
      <td>101.525974</td>
      <td>96.567532</td>
      <td>37.484805</td>
      <td>259.129870</td>
      <td>623.337662</td>
      <td>1236.240260</td>
      <td>3.616364</td>
      <td>1.707231</td>
      <td>2276.292208</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 10</th>
      <td>105.308287</td>
      <td>71.392265</td>
      <td>83.322652</td>
      <td>73.269613</td>
      <td>76.519337</td>
      <td>296.044199</td>
      <td>822.773481</td>
      <td>620.046409</td>
      <td>5.592928</td>
      <td>0.900290</td>
      <td>...</td>
      <td>88.494526</td>
      <td>69.306569</td>
      <td>83.577007</td>
      <td>301.925182</td>
      <td>876.195255</td>
      <td>723.797445</td>
      <td>5.779927</td>
      <td>0.938234</td>
      <td>1250.994526</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 11</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 11</th>
      <td>130.189336</td>
      <td>78.165397</td>
      <td>99.374320</td>
      <td>91.220892</td>
      <td>45.370511</td>
      <td>255.816104</td>
      <td>663.803047</td>
      <td>1458.297062</td>
      <td>4.125027</td>
      <td>1.467398</td>
      <td>...</td>
      <td>91.247253</td>
      <td>94.151099</td>
      <td>45.262637</td>
      <td>254.162088</td>
      <td>642.431319</td>
      <td>1407.892857</td>
      <td>4.251786</td>
      <td>1.304566</td>
      <td>1739.418956</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 12</th>
      <td>113.641154</td>
      <td>79.105395</td>
      <td>93.521957</td>
      <td>79.949812</td>
      <td>49.871016</td>
      <td>275.690088</td>
      <td>753.262233</td>
      <td>830.787955</td>
      <td>3.966123</td>
      <td>1.421580</td>
      <td>...</td>
      <td>101.213292</td>
      <td>81.173107</td>
      <td>61.067697</td>
      <td>277.349304</td>
      <td>742.272025</td>
      <td>1097.418856</td>
      <td>4.938949</td>
      <td>1.237804</td>
      <td>1650.420402</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 13</th>
      <td>153.799539</td>
      <td>94.494240</td>
      <td>120.074885</td>
      <td>73.370968</td>
      <td>29.923618</td>
      <td>284.487327</td>
      <td>822.304147</td>
      <td>1506.566820</td>
      <td>2.184793</td>
      <td>3.328818</td>
      <td>...</td>
      <td>118.593614</td>
      <td>65.931785</td>
      <td>34.761974</td>
      <td>299.825835</td>
      <td>920.703919</td>
      <td>1748.258345</td>
      <td>2.276778</td>
      <td>3.164370</td>
      <td>4219.204644</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant14</th>
      <td>110.663357</td>
      <td>65.892751</td>
      <td>85.097319</td>
      <td>101.382324</td>
      <td>55.351936</td>
      <td>249.021847</td>
      <td>596.583913</td>
      <td>1170.305859</td>
      <td>5.583913</td>
      <td>0.918202</td>
      <td>...</td>
      <td>95.851064</td>
      <td>101.436796</td>
      <td>63.840926</td>
      <td>248.873592</td>
      <td>600.963705</td>
      <td>1666.147685</td>
      <td>6.453191</td>
      <td>0.902253</td>
      <td>1203.013767</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>146.770254</td>
      <td>91.220073</td>
      <td>110.955260</td>
      <td>83.553809</td>
      <td>94.748126</td>
      <td>284.510278</td>
      <td>725.622733</td>
      <td>1377.804111</td>
      <td>7.892624</td>
      <td>0.851979</td>
      <td>...</td>
      <td>121.593900</td>
      <td>78.871589</td>
      <td>93.343660</td>
      <td>292.271268</td>
      <td>770.882825</td>
      <td>1666.252006</td>
      <td>7.341413</td>
      <td>1.003722</td>
      <td>1338.282504</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>16</th>
      <td>127.301105</td>
      <td>89.838398</td>
      <td>101.250000</td>
      <td>72.772099</td>
      <td>61.178315</td>
      <td>288.038674</td>
      <td>828.674033</td>
      <td>801.943370</td>
      <td>4.440884</td>
      <td>1.374302</td>
      <td>...</td>
      <td>103.336283</td>
      <td>71.086726</td>
      <td>54.882655</td>
      <td>283.743363</td>
      <td>849.628319</td>
      <td>714.893805</td>
      <td>3.890442</td>
      <td>1.603179</td>
      <td>2137.545133</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 17</th>
      <td>134.065134</td>
      <td>84.581098</td>
      <td>102.873563</td>
      <td>78.996169</td>
      <td>62.525032</td>
      <td>302.247765</td>
      <td>765.593870</td>
      <td>1037.118774</td>
      <td>4.920690</td>
      <td>1.268326</td>
      <td>...</td>
      <td>104.625413</td>
      <td>78.064356</td>
      <td>62.809571</td>
      <td>308.778878</td>
      <td>776.245875</td>
      <td>1111.288779</td>
      <td>4.877723</td>
      <td>1.303726</td>
      <td>1738.303630</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 18</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>82.908333</td>
      <td>69.183333</td>
      <td>69.906667</td>
      <td>283.000000</td>
      <td>978.833333</td>
      <td>2980.658333</td>
      <td>4.875000</td>
      <td>1.508275</td>
      <td>2011.033333</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>20 rows × 36 columns</p>
</div>
</div>
</div>
<p>As we can see from the rows above, the files are being read in, but because the naming of the folders and files hasn’t been fixed the rows are very messy. For example, we can see that there are 3 rows the ‘Participant 11’ in the ‘Participant ID’ column. This is because there’s 3 different folders with the name ‘Participant 11’ followed by date and time information. This is because there are 3 different participant 11 (maybe there was multiple starts and stops with this person?).</p>
<p>If we look at the folder called <code>'all_data\Finometer Data Semester 1 and 2 14.04.23\Participant 3_2022-10-27_12.16.15'</code> we can see that the files are called <code>'Participant 3_2022-10-27_12.16.15\Eve_2022-10-27_12.16.15....'</code> so the filenames don’t match the folder names and the ID’s within the <code>.txt</code> files match the file names and not the folders.</p>
<p>I need to fix this for this project (and make sure it doesn’t happen in future projects)</p>
<p>So lets start by deleting folders that don’t belong any more, this will include the duplicates and the ‘Part 2’ Folders that we mentioned earlier.</p>
<p>(This is being done manually so there’s no code cell for it…)</p>
<p>Then I need to iterate over every folder, then over the files in each folder, and if the file stems don’t match the folder name I need to replace them. This is worrying though because if we examine the particpant 7 folder, the <code>.txt</code> file is called ’_2022-10-28_13.40.16\8_2022-10-28_13.40.16.txt`’</p>
<p>I’m just going to trust that the folder titles are correct and go with that.</p>
<pre><code>
#converting this cell to Markdown so it doesn't run again when knitting

#renaming the files stems to match the folder names
# iterate over the top level of the data folder
for i in data_folder.glob('*'):
    #check to see if the file is a directory
    if i.is_dir():
        #iterate over the files in the directory
        for j in i.glob('*'):
            #check if the file stem is the same as the folder stem
            if j.stem == i.stem:
                pass
            #if not, rename the file stem to match the folder stem with the original suffix
            else:
                j.rename(j.parent / f"{i.stem}{j.suffix}")
</code></pre>
<p>Now that that’s done, we can rerun the cell that made that results df for us again, I’m going to paste a new cell in to do this instead of just going back up and rerunning the cell, I save a second version of the excel file then, that is named for (<em>hopefully</em>) with the correct participant names in the ID columns</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this cell runs the functions on all the different files and writes them to a single dataframe</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> []</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> y.iterrows():</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">id</span> <span class="op">=</span> row[<span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    times <span class="op">=</span> {<span class="st">'baseline'</span> : [row[<span class="dv">1</span>][<span class="dv">1</span>], row[<span class="dv">1</span>][<span class="dv">2</span>]], <span class="st">'task'</span> : [row[<span class="dv">1</span>][<span class="dv">3</span>], row[<span class="dv">1</span>][<span class="dv">4</span>]], <span class="st">'recovery'</span> : [row[<span class="dv">1</span>][<span class="dv">5</span>], row[<span class="dv">1</span>][<span class="dv">6</span>]]}</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> folder <span class="kw">in</span> data_folder.glob(<span class="st">'**'</span>):</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">id</span> <span class="op">==</span> folder.stem.split(<span class="st">'_'</span>)[<span class="dv">0</span>]:</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>            df, df_id <span class="op">=</span> read_raw_finometer_data(folder)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>                dfs.append(import_protocol_averages(df, df_id, times))</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(<span class="ss">f"Could not import protocol averages for </span><span class="sc">{</span><span class="bu">id</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'default'</span>)</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>new_result_df <span class="op">=</span> pd.concat(dfs, axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># viewing the first 20 rows of the new dataframe</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>new_result_df.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>baseline Systolic Pressure (mmHg)</th>
      <th>baseline Diastolic Pressure (mmHg)</th>
      <th>baseline Mean Pressure (mmHg)</th>
      <th>baseline Heart rate (bpm)</th>
      <th>baseline Stroke Volume (ml)</th>
      <th>baseline Left Ventricular Ejection Time (ms)</th>
      <th>baseline Pulse Interval (ms)</th>
      <th>baseline Maximum Slope (mmHg/s)</th>
      <th>baseline Cardiac Output (l/min)</th>
      <th>baseline Total Peripheral Resistance Medical Unit (mmHg.min/l)</th>
      <th>...</th>
      <th>recovery Mean Pressure (mmHg)</th>
      <th>recovery Heart rate (bpm)</th>
      <th>recovery Stroke Volume (ml)</th>
      <th>recovery Left Ventricular Ejection Time (ms)</th>
      <th>recovery Pulse Interval (ms)</th>
      <th>recovery Maximum Slope (mmHg/s)</th>
      <th>recovery Cardiac Output (l/min)</th>
      <th>recovery Total Peripheral Resistance Medical Unit (mmHg.min/l)</th>
      <th>recovery Total Peripheral Resistance CGS (dyn.s/cm5)</th>
      <th>recovery Markers</th>
    </tr>
    <tr>
      <th>Participant ID</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Participant 1</th>
      <td>201.177229</td>
      <td>158.281418</td>
      <td>175.578947</td>
      <td>93.785177</td>
      <td>16.931901</td>
      <td>241.997852</td>
      <td>644.624060</td>
      <td>1120.077336</td>
      <td>1.583673</td>
      <td>6.766189</td>
      <td>...</td>
      <td>184.357039</td>
      <td>86.988389</td>
      <td>15.967634</td>
      <td>247.358491</td>
      <td>696.262700</td>
      <td>1243.576197</td>
      <td>1.388824</td>
      <td>8.275520</td>
      <td>11034.023222</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 2</th>
      <td>174.749768</td>
      <td>119.989805</td>
      <td>142.184430</td>
      <td>78.142725</td>
      <td>28.795366</td>
      <td>219.295644</td>
      <td>778.234476</td>
      <td>1413.936979</td>
      <td>2.239296</td>
      <td>3.875071</td>
      <td>...</td>
      <td>146.425325</td>
      <td>76.980519</td>
      <td>29.906818</td>
      <td>288.733766</td>
      <td>787.873377</td>
      <td>1734.563312</td>
      <td>2.287013</td>
      <td>3.879511</td>
      <td>5172.691558</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 3</th>
      <td>129.075871</td>
      <td>83.501244</td>
      <td>99.720149</td>
      <td>84.395522</td>
      <td>54.166667</td>
      <td>266.194030</td>
      <td>746.262438</td>
      <td>1421.238806</td>
      <td>4.529975</td>
      <td>1.500659</td>
      <td>...</td>
      <td>102.937500</td>
      <td>81.082721</td>
      <td>61.361949</td>
      <td>276.966912</td>
      <td>781.360294</td>
      <td>1611.580882</td>
      <td>4.899081</td>
      <td>1.974364</td>
      <td>2632.485294</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 4</th>
      <td>138.128621</td>
      <td>92.714948</td>
      <td>109.310545</td>
      <td>86.833140</td>
      <td>40.428158</td>
      <td>267.937428</td>
      <td>695.185400</td>
      <td>1201.106605</td>
      <td>3.502549</td>
      <td>1.892425</td>
      <td>...</td>
      <td>119.121508</td>
      <td>90.459497</td>
      <td>35.469972</td>
      <td>264.385475</td>
      <td>670.181564</td>
      <td>1402.484637</td>
      <td>3.204050</td>
      <td>2.278200</td>
      <td>3037.578212</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 5</th>
      <td>93.990654</td>
      <td>80.220561</td>
      <td>85.323364</td>
      <td>64.459813</td>
      <td>18.105794</td>
      <td>289.803738</td>
      <td>1026.046729</td>
      <td>239.471028</td>
      <td>1.179252</td>
      <td>6.109763</td>
      <td>...</td>
      <td>88.366730</td>
      <td>67.362949</td>
      <td>34.604537</td>
      <td>293.667297</td>
      <td>907.759924</td>
      <td>397.132325</td>
      <td>2.319660</td>
      <td>2.364981</td>
      <td>3153.315690</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 6</th>
      <td>106.450131</td>
      <td>79.707349</td>
      <td>85.530184</td>
      <td>73.707349</td>
      <td>31.032021</td>
      <td>294.967192</td>
      <td>819.061680</td>
      <td>623.863517</td>
      <td>2.281365</td>
      <td>2.324482</td>
      <td>...</td>
      <td>83.608014</td>
      <td>73.200348</td>
      <td>33.649826</td>
      <td>286.829268</td>
      <td>838.736934</td>
      <td>874.921603</td>
      <td>2.455749</td>
      <td>2.189387</td>
      <td>2919.163763</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 7</th>
      <td>116.379518</td>
      <td>62.829819</td>
      <td>83.042922</td>
      <td>98.686747</td>
      <td>92.937801</td>
      <td>267.074548</td>
      <td>611.573795</td>
      <td>1552.516566</td>
      <td>9.143599</td>
      <td>0.554955</td>
      <td>...</td>
      <td>91.721193</td>
      <td>98.309671</td>
      <td>89.174794</td>
      <td>264.660494</td>
      <td>617.217078</td>
      <td>1940.726337</td>
      <td>8.755041</td>
      <td>0.652887</td>
      <td>870.530864</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 8</th>
      <td>201.799232</td>
      <td>144.032661</td>
      <td>161.606148</td>
      <td>109.024976</td>
      <td>55.949952</td>
      <td>285.806916</td>
      <td>570.100865</td>
      <td>1240.792507</td>
      <td>6.113641</td>
      <td>1.783168</td>
      <td>...</td>
      <td>170.406286</td>
      <td>102.499418</td>
      <td>47.423050</td>
      <td>278.981374</td>
      <td>607.409779</td>
      <td>1168.190920</td>
      <td>4.862049</td>
      <td>2.428739</td>
      <td>3238.316647</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 9</th>
      <td>125.233402</td>
      <td>73.839212</td>
      <td>91.713693</td>
      <td>96.490664</td>
      <td>48.927282</td>
      <td>251.312241</td>
      <td>622.702282</td>
      <td>1395.449170</td>
      <td>4.715975</td>
      <td>1.170438</td>
      <td>...</td>
      <td>101.525974</td>
      <td>96.567532</td>
      <td>37.484805</td>
      <td>259.129870</td>
      <td>623.337662</td>
      <td>1236.240260</td>
      <td>3.616364</td>
      <td>1.707231</td>
      <td>2276.292208</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 10</th>
      <td>105.308287</td>
      <td>71.392265</td>
      <td>83.322652</td>
      <td>73.269613</td>
      <td>76.519337</td>
      <td>296.044199</td>
      <td>822.773481</td>
      <td>620.046409</td>
      <td>5.592928</td>
      <td>0.900290</td>
      <td>...</td>
      <td>88.494526</td>
      <td>69.306569</td>
      <td>83.577007</td>
      <td>301.925182</td>
      <td>876.195255</td>
      <td>723.797445</td>
      <td>5.779927</td>
      <td>0.938234</td>
      <td>1250.994526</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 11</th>
      <td>130.189336</td>
      <td>78.165397</td>
      <td>99.374320</td>
      <td>91.220892</td>
      <td>45.370511</td>
      <td>255.816104</td>
      <td>663.803047</td>
      <td>1458.297062</td>
      <td>4.125027</td>
      <td>1.467398</td>
      <td>...</td>
      <td>91.247253</td>
      <td>94.151099</td>
      <td>45.262637</td>
      <td>254.162088</td>
      <td>642.431319</td>
      <td>1407.892857</td>
      <td>4.251786</td>
      <td>1.304566</td>
      <td>1739.418956</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 12</th>
      <td>113.641154</td>
      <td>79.105395</td>
      <td>93.521957</td>
      <td>79.949812</td>
      <td>49.871016</td>
      <td>275.690088</td>
      <td>753.262233</td>
      <td>830.787955</td>
      <td>3.966123</td>
      <td>1.421580</td>
      <td>...</td>
      <td>101.213292</td>
      <td>81.173107</td>
      <td>61.067697</td>
      <td>277.349304</td>
      <td>742.272025</td>
      <td>1097.418856</td>
      <td>4.938949</td>
      <td>1.237804</td>
      <td>1650.420402</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 13</th>
      <td>153.799539</td>
      <td>94.494240</td>
      <td>120.074885</td>
      <td>73.370968</td>
      <td>29.923618</td>
      <td>284.487327</td>
      <td>822.304147</td>
      <td>1506.566820</td>
      <td>2.184793</td>
      <td>3.328818</td>
      <td>...</td>
      <td>118.593614</td>
      <td>65.931785</td>
      <td>34.761974</td>
      <td>299.825835</td>
      <td>920.703919</td>
      <td>1748.258345</td>
      <td>2.276778</td>
      <td>3.164370</td>
      <td>4219.204644</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 14</th>
      <td>110.663357</td>
      <td>65.892751</td>
      <td>85.097319</td>
      <td>101.382324</td>
      <td>55.351936</td>
      <td>249.021847</td>
      <td>596.583913</td>
      <td>1170.305859</td>
      <td>5.583913</td>
      <td>0.918202</td>
      <td>...</td>
      <td>95.851064</td>
      <td>101.436796</td>
      <td>63.840926</td>
      <td>248.873592</td>
      <td>600.963705</td>
      <td>1666.147685</td>
      <td>6.453191</td>
      <td>0.902253</td>
      <td>1203.013767</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 15</th>
      <td>146.770254</td>
      <td>91.220073</td>
      <td>110.955260</td>
      <td>83.553809</td>
      <td>94.748126</td>
      <td>284.510278</td>
      <td>725.622733</td>
      <td>1377.804111</td>
      <td>7.892624</td>
      <td>0.851979</td>
      <td>...</td>
      <td>121.593900</td>
      <td>78.871589</td>
      <td>93.343660</td>
      <td>292.271268</td>
      <td>770.882825</td>
      <td>1666.252006</td>
      <td>7.341413</td>
      <td>1.003722</td>
      <td>1338.282504</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 16</th>
      <td>127.301105</td>
      <td>89.838398</td>
      <td>101.250000</td>
      <td>72.772099</td>
      <td>61.178315</td>
      <td>288.038674</td>
      <td>828.674033</td>
      <td>801.943370</td>
      <td>4.440884</td>
      <td>1.374302</td>
      <td>...</td>
      <td>103.336283</td>
      <td>71.086726</td>
      <td>54.882655</td>
      <td>283.743363</td>
      <td>849.628319</td>
      <td>714.893805</td>
      <td>3.890442</td>
      <td>1.603179</td>
      <td>2137.545133</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 17</th>
      <td>134.065134</td>
      <td>84.581098</td>
      <td>102.873563</td>
      <td>78.996169</td>
      <td>62.525032</td>
      <td>302.247765</td>
      <td>765.593870</td>
      <td>1037.118774</td>
      <td>4.920690</td>
      <td>1.268326</td>
      <td>...</td>
      <td>104.625413</td>
      <td>78.064356</td>
      <td>62.809571</td>
      <td>308.778878</td>
      <td>776.245875</td>
      <td>1111.288779</td>
      <td>4.877723</td>
      <td>1.303726</td>
      <td>1738.303630</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 18</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>82.908333</td>
      <td>69.183333</td>
      <td>69.906667</td>
      <td>283.000000</td>
      <td>978.833333</td>
      <td>2980.658333</td>
      <td>4.875000</td>
      <td>1.508275</td>
      <td>2011.033333</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 19</th>
      <td>130.547507</td>
      <td>81.548448</td>
      <td>101.300094</td>
      <td>107.088429</td>
      <td>48.333114</td>
      <td>246.053622</td>
      <td>564.256820</td>
      <td>1665.835372</td>
      <td>5.163594</td>
      <td>1.187425</td>
      <td>...</td>
      <td>103.176471</td>
      <td>107.639706</td>
      <td>46.662745</td>
      <td>247.555147</td>
      <td>562.261029</td>
      <td>1504.511029</td>
      <td>5.006250</td>
      <td>1.255143</td>
      <td>1673.507353</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>Participant 20</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>90.977867</td>
      <td>62.623742</td>
      <td>58.312274</td>
      <td>338.571429</td>
      <td>965.462777</td>
      <td>732.987928</td>
      <td>3.639638</td>
      <td>1.508684</td>
      <td>2011.575453</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>20 rows × 36 columns</p>
</div>
</div>
</div>
<p>The head of that dataset looks much better, there’s an issue with participant 10 and 20 but everyone else looks good. Hopefully this data is enough for you to work with.</p>
<p>I’m going to save it to an excel file now.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>new_result_df.to_excel(output<span class="op">/</span><span class="st">'Ailbhe data time one and two (naming fixed).xlsx'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>OK, so you should now have 2 datasets, one which has loads of bad data in it to show you how important it is to get the protocol right, and one where the data has been pre cleaned a little. Hopefully this is enough for you to do the analysis with Stephen on Monday.</p>
<p>All the best,</p>
<p>Kev</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>